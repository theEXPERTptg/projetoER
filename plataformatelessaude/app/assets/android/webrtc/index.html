<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="device-width, initial-scale=1.0"/>
<style>
    video {
        width: 100%;
        max-height: 200px;
        background: #000;
    }
    #localVideo, #remoteVideo {
        margin-bottom: 10px;
    }
    #myId {
        font-size: 16px;
        margin: 10px 0;
        color: #333;
    }
</style>
</head>
<body>
    <video id="localVideo" autoplay muted playsinline></video>
    <video id="remoteVideo" autoplay playsinline></video>
    <div id="myId">Your ID: (waiting...)</div>

    <script src="https://unpkg.com/peerjs@1.3.2/dist/peerjs.min.js"></script>
    <script>
        var currentPeerId = ""; 
        var localStream = null;
        var peer = new Peer(); // Using default PeerJS Cloud server

        // Get user media (camera & mic)
        navigator.mediaDevices.getUserMedia({ video: true, audio: true })
        .then(stream => {
            localStream = stream;
            document.getElementById('localVideo').srcObject = stream;
        })
        .catch(err => {
            console.error("Failed to get local stream:", err);
        });

        // On peer open (when we get our ID from the server)
        peer.on('open', function(id) {
            console.log("My peer ID is: " + id);
            currentPeerId = id; 
            // Update the HTML element with the ID
            document.getElementById('myId').textContent = "Your ID: " + id;
        });

        // Handle incoming calls
        peer.on('call', function(call) {
            console.log("Incoming call from: ", call.peer);
            call.answer(localStream); // Answer with our own stream
            call.on('stream', function(remoteStream) {
                document.getElementById('remoteVideo').srcObject = remoteStream;
            });
        });

        // Start a call to the given friendId
        function startCall(friendId) {
            if (!localStream) {
                alert("No local stream yet. Check camera/mic permissions.");
                return;
            }
            var call = peer.call(friendId, localStream);
            call.on('stream', function(remoteStream) {
                document.getElementById('remoteVideo').srcObject = remoteStream;
            });
        }
    </script>
</body>
</html>
